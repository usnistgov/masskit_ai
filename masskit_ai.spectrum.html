
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>masskit_ai.spectrum package &#8212; masskit_ai 0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/nature.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
<link rel="stylesheet" href="https://pages.nist.gov/nist-header-footer/css/nist-combined.css">
  <script src="https://code.jquery.com/jquery-1.12.4.min.js" type="text/javascript"></script>
  <script src="https://pages.nist.gov/nist-header-footer/js/nist-header-footer.js" type="text/javascript" defer="defer"></script>


<script type="text/javascript" src="https://pages.nist.gov/leaveNotice/js/jquery.leaveNotice-nist.min.js"></script>
<script>
$(document).ready(function(){
  // Mark external (non-nist.gov) A tags with class "external"
  //If the adress start with https and ends with nist.gov
  var re_nist = new RegExp('^https?:\/\/((^\/)*\.)*nist\\.gov(\/|$)');
  //Regex to find address that start with https
  var re_absolute_address = new RegExp('^((https?:)?\/\/)');
  $("a").each(function(){
    var url=$(this).attr('href');
    if(re_nist.test(url) || !re_absolute_address.test(url)){
      $(this).addClass('local');
    }else{
      //This a href appears to be external, so tag it
      $(this).addClass('external');
    }
  });
  // Add leaveNotice to external A elements
  $('a.external').leaveNotice();
});
</script>
<link rel="stylesheet" type="text/css" href="https://pages.nist.gov/leaveNotice/css/jquery.leaveNotice.css" />


  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">masskit_ai 0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">masskit_ai.spectrum package</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="masskit-ai-spectrum-package">
<h1>masskit_ai.spectrum package<a class="headerlink" href="#masskit-ai-spectrum-package" title="Permalink to this heading">¶</a></h1>
<section id="subpackages">
<h2>Subpackages<a class="headerlink" href="#subpackages" title="Permalink to this heading">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="masskit_ai.spectrum.peptide.html">masskit_ai.spectrum.peptide package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="masskit_ai.spectrum.peptide.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="masskit_ai.spectrum.peptide.models.html">masskit_ai.spectrum.peptide.models package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="masskit_ai.spectrum.peptide.models.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="masskit_ai.spectrum.peptide.models.html#module-masskit_ai.spectrum.peptide.models.AIomicsRNN">masskit_ai.spectrum.peptide.models.AIomicsRNN module</a></li>
<li class="toctree-l4"><a class="reference internal" href="masskit_ai.spectrum.peptide.models.html#module-masskit_ai.spectrum.peptide.models.aiomic">masskit_ai.spectrum.peptide.models.aiomic module</a></li>
<li class="toctree-l4"><a class="reference internal" href="masskit_ai.spectrum.peptide.models.html#module-masskit_ai.spectrum.peptide.models.dense">masskit_ai.spectrum.peptide.models.dense module</a></li>
<li class="toctree-l4"><a class="reference internal" href="masskit_ai.spectrum.peptide.models.html#module-masskit_ai.spectrum.peptide.models.flipyflopy">masskit_ai.spectrum.peptide.models.flipyflopy module</a></li>
<li class="toctree-l4"><a class="reference internal" href="masskit_ai.spectrum.peptide.models.html#module-masskit_ai.spectrum.peptide.models">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="masskit_ai.spectrum.peptide.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="masskit_ai.spectrum.peptide.html#module-masskit_ai.spectrum.peptide.peptide_callbacks">masskit_ai.spectrum.peptide.peptide_callbacks module</a></li>
<li class="toctree-l2"><a class="reference internal" href="masskit_ai.spectrum.peptide.html#module-masskit_ai.spectrum.peptide.peptide_constants">masskit_ai.spectrum.peptide.peptide_constants module</a></li>
<li class="toctree-l2"><a class="reference internal" href="masskit_ai.spectrum.peptide.html#module-masskit_ai.spectrum.peptide.peptide_embed">masskit_ai.spectrum.peptide.peptide_embed module</a></li>
<li class="toctree-l2"><a class="reference internal" href="masskit_ai.spectrum.peptide.html#module-masskit_ai.spectrum.peptide.peptide_samplers">masskit_ai.spectrum.peptide.peptide_samplers module</a></li>
<li class="toctree-l2"><a class="reference internal" href="masskit_ai.spectrum.peptide.html#module-masskit_ai.spectrum.peptide">Module contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="masskit_ai.spectrum.small_mol.html">masskit_ai.spectrum.small_mol package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="masskit_ai.spectrum.small_mol.html#subpackages">Subpackages</a><ul>
<li class="toctree-l3"><a class="reference internal" href="masskit_ai.spectrum.small_mol.models.html">masskit_ai.spectrum.small_mol.models package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="masskit_ai.spectrum.small_mol.models.html#submodules">Submodules</a></li>
<li class="toctree-l4"><a class="reference internal" href="masskit_ai.spectrum.small_mol.models.html#module-masskit_ai.spectrum.small_mol.models.small_mol_models">masskit_ai.spectrum.small_mol.models.small_mol_models module</a></li>
<li class="toctree-l4"><a class="reference internal" href="masskit_ai.spectrum.small_mol.models.html#module-masskit_ai.spectrum.small_mol.models">Module contents</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="masskit_ai.spectrum.small_mol.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="masskit_ai.spectrum.small_mol.html#module-masskit_ai.spectrum.small_mol.small_mol_datasets">masskit_ai.spectrum.small_mol.small_mol_datasets module</a></li>
<li class="toctree-l2"><a class="reference internal" href="masskit_ai.spectrum.small_mol.html#module-masskit_ai.spectrum.small_mol.small_mol_lightning">masskit_ai.spectrum.small_mol.small_mol_lightning module</a></li>
<li class="toctree-l2"><a class="reference internal" href="masskit_ai.spectrum.small_mol.html#module-masskit_ai.spectrum.small_mol.small_mol_losses">masskit_ai.spectrum.small_mol.small_mol_losses module</a></li>
<li class="toctree-l2"><a class="reference internal" href="masskit_ai.spectrum.small_mol.html#module-masskit_ai.spectrum.small_mol">Module contents</a></li>
</ul>
</li>
</ul>
</div>
</section>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this heading">¶</a></h2>
</section>
<section id="module-masskit_ai.spectrum.spectrum_base_objects">
<span id="masskit-ai-spectrum-spectrum-base-objects-module"></span><h2>masskit_ai.spectrum.spectrum_base_objects module<a class="headerlink" href="#module-masskit_ai.spectrum.spectrum_base_objects" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_base_objects.</span></span><span class="sig-name descname"><span class="pre">BaseSpectrumLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="masskit_ai.html#masskit_ai.base_objects.BaseLoss" title="masskit_ai.base_objects.BaseLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseLoss</span></code></a></p>
<p>abstract base class for spectrum losses
assumes spectra have dimensions (batch, channel, mz_array)</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss.extract_spectra">
<span class="sig-name descname"><span class="pre">extract_spectra</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss.extract_spectra" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss.extract_variance">
<span class="sig-name descname"><span class="pre">extract_variance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_tensor</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">torch.Tensor</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss.extract_variance" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss.forward">
<em class="property"><span class="pre">abstract</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model, type ModelOutput</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader, type ModelInput</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_base_objects.SpectrumModel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_base_objects.</span></span><span class="sig-name descname"><span class="pre">SpectrumModel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_base_objects.SpectrumModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_base_objects.SpectrumModule" title="masskit_ai.spectrum.spectrum_base_objects.SpectrumModule"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpectrumModule</span></code></a></p>
<p>base class for spectral prediction models</p>
<ul class="simple">
<li><p>the “output” from the model is a dictionary
- output[‘y_prime’] contains a batch of predicted spectra</p></li>
<li><p>“batch” is the input to the model
- batch[‘y’] is a batch of experimental spectra corresponding to the predicted spectra
- each batch of spectra is a float 32 tensor of shape (batch, channel, mz_bins)</p></li>
<li><p>by convention, channel 0 are intensities, which are not necessarily scaled</p></li>
<li><p>channel 1 are standard deviations of the corresponding intensities</p></li>
</ul>
<dl class="py property">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_base_objects.SpectrumModel.channels">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">channels</span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_base_objects.SpectrumModel.channels" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate number of channels in the input</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_base_objects.SpectrumModule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_base_objects.</span></span><span class="sig-name descname"><span class="pre">SpectrumModule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_base_objects.SpectrumModule" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Module</span></code></p>
<p>base class for a spectrum module.  contains the configuration object.</p>
<dl class="py property">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_base_objects.SpectrumModule.bins">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">bins</span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_base_objects.SpectrumModule.bins" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate number of bins in the output spectrum</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-masskit_ai.spectrum.spectrum_datasets">
<span id="masskit-ai-spectrum-spectrum-datasets-module"></span><h2>masskit_ai.spectrum.spectrum_datasets module<a class="headerlink" href="#module-masskit_ai.spectrum.spectrum_datasets" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_datasets.SpectrumDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_datasets.</span></span><span class="sig-name descname"><span class="pre">SpectrumDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_datasets.SpectrumDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="masskit_ai.html#masskit_ai.base_datasets.BaseDataset" title="masskit_ai.base_datasets.BaseDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseDataset</span></code></a></p>
<p>Base spectrum dataset</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_datasets.SpectrumDataset.get_y">
<span class="sig-name descname"><span class="pre">get_y</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data_row</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_datasets.SpectrumDataset.get_y" title="Permalink to this definition">¶</a></dt>
<dd><p>given the data row, return the target of the network</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_datasets.TandemArrowDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_datasets.</span></span><span class="sig-name descname"><span class="pre">TandemArrowDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_datasets.TandemArrowDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_datasets.SpectrumDataset" title="masskit_ai.spectrum.spectrum_datasets.SpectrumDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpectrumDataset</span></code></a></p>
<p>class for accessing a tandem dataframe of spectra</p>
<p>How workers are set up requires some explanation:</p>
<ul class="simple">
<li><p>if there is more than one gpu, each gpu has a corresponding main process.</p></li>
<li><p>the numbering of this gpu within a node is given by the environment variable LOCAL_RANK</p></li>
<li><p>if there is more than one node, the numbering of the node is given by the NODE_RANK environment variable</p></li>
<li><p>the number of nodes times the number of gpus is given by the WORLD_SIZE environment variable</p></li>
<li><p>the number of gpus on the current node can be found by parsing the PL_TRAINER_GPUS environment variable</p></li>
<li><p>these environment variables are only available when doing ddp.  Otherwise sharding should be done using id and num_workers in torch.utils.data.get_worker_info()</p></li>
<li><p>each main process creates an instance of Dataset.  This instance is NOT initialized by worker_init_fn, only the constructor.</p></li>
<li><p>each worker is created by forking the main process, giving each worker a copy of Dataset, already constructed.
- each of these forked Datasets is initialized by worker_init_fn
- the global torch.utils.data.get_worker_info() contains a reference to the forked Dataset and other info
- these workers then take turns feeding minibatches into the training process
- <strong>*important*</strong> since each worker is a copy, __init__() is only called once, only in the main process</p></li>
<li><p>the dataset in the main processes is used by other steps, such as the validation callback
- this means that if there is any important initialization done in worker_init_fn, it must explicitly be done to the main process Dataset</p></li>
<li><dl class="simple">
<dt>alternative sources of parameters:</dt><dd><ul>
<li><p>global_rank = trainer.node_rank * trainer.nudatasetm_processes + process_idx</p></li>
<li><p>world_size = trainer.num_nodes * trainer.num_processes</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<dl class="py property">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_datasets.TandemArrowDataset.data">
<em class="property"><span class="pre">property</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">data</span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_datasets.TandemArrowDataset.data" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_datasets.TandemArrowDataset.get_column">
<span class="sig-name descname"><span class="pre">get_column</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">column</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_datasets.TandemArrowDataset.get_column" title="Permalink to this definition">¶</a></dt>
<dd><p>retrieve a column from the parquet file</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>column</strong> – the column to retrieve</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_datasets.TandemArrowDataset.get_data_row">
<span class="sig-name descname"><span class="pre">get_data_row</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_datasets.TandemArrowDataset.get_data_row" title="Permalink to this definition">¶</a></dt>
<dd><p>given the index, return corresponding data for the index</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_datasets.TandemArrowDataset.init_plasma">
<span class="sig-name descname"><span class="pre">init_plasma</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_datasets.TandemArrowDataset.init_plasma" title="Permalink to this definition">¶</a></dt>
<dd><p>used for lazy initialization of plasma client.  Since lightning copies dataset objects on forking, if a client is in
in the original process, then it will be deleted in the copied process when replaced with a new copy of the client
causing the any corresponding objects in the plasma store to be deleted as they are refcounted by connection.  So
we only create the client when we need to get the data.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_datasets.TandemArrowDataset.to_pandas">
<span class="sig-name descname"><span class="pre">to_pandas</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_datasets.TandemArrowDataset.to_pandas" title="Permalink to this definition">¶</a></dt>
<dd><p>return data as pandas dataframe</p>
<dl class="field-list simple">
<dt class="field-odd">Raises<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>NotImplementedError</strong> – not implemented</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_datasets.TandemDataframeDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_datasets.</span></span><span class="sig-name descname"><span class="pre">TandemDataframeDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_datasets.TandemDataframeDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_datasets.SpectrumDataset" title="masskit_ai.spectrum.spectrum_datasets.SpectrumDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpectrumDataset</span></code></a>, <a class="reference internal" href="masskit_ai.html#masskit_ai.base_datasets.DataframeDataset" title="masskit_ai.base_datasets.DataframeDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataframeDataset</span></code></a></p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_datasets.TandemDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_datasets.</span></span><span class="sig-name descname"><span class="pre">TandemDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_datasets.TandemDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_datasets.SpectrumDataset" title="masskit_ai.spectrum.spectrum_datasets.SpectrumDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpectrumDataset</span></code></a></p>
<p>base map Dataset for operating on a pandas dataframe which is loaded from sql.  index2id in this class
are indices into the dataframe.  The list is assumed to have
been already prefiltered by query, e.g. only the training set and by the GPU rank if using
DistributedDataParallel.</p>
<p>How workers are set up requires some explanation:</p>
<ul class="simple">
<li><p>if there is more than one gpu, each gpu has a corresponding main process.</p></li>
<li><p>the numbering of this gpu within a node is given by the environment variable LOCAL_RANK</p></li>
<li><p>if there is more than one node, the numbering of the node is given by the NODE_RANK environment variable</p></li>
<li><p>the number of nodes times the number of gpus is given by the WORLD_SIZE environment variable</p></li>
<li><p>the number of gpus on the current node can be found by parsing the PL_TRAINER_GPUS environment variable</p></li>
<li><p>these environment variables are only available when doing ddp.  Otherwise sharding should be done using id and num_workers in torch.utils.data.get_worker_info()</p></li>
<li><p>each main process creates an instance of Dataset.  This instance is NOT initialized by worker_init_fn, only the constructor.</p></li>
<li><p>each worker is created by forking the main process, giving each worker a copy of Dataset, already constructed.
- each of these forked Datasets is initialized by worker_init_fn
- the global torch.utils.data.get_worker_info() contains a reference to the forked Dataset and other info
- these workers then take turns feeding minibatches into the training process
- <strong>*important*</strong> since each worker is a copy, __init__() is only called once, only in the main process</p></li>
<li><p>the dataset in the main processes is used by other steps, such as the validation callback
- this means that if there is any important initialization done in worker_init_fn, it must explicitly be done to the main process Dataset</p></li>
<li><dl class="simple">
<dt>alternative sources of parameters:</dt><dd><ul>
<li><p>global_rank = trainer.node_rank * trainer.num_processes + process_idx</p></li>
<li><p>world_size = trainer.num_nodes * trainer.num_processes</p></li>
</ul>
</dd>
</dl>
</li>
</ul>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_datasets.TandemDataset.get_data_row">
<span class="sig-name descname"><span class="pre">get_data_row</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_datasets.TandemDataset.get_data_row" title="Permalink to this definition">¶</a></dt>
<dd><p>given the index, return corresponding data for the index</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_datasets.TandemQueryDataset">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_datasets.</span></span><span class="sig-name descname"><span class="pre">TandemQueryDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_datasets.TandemQueryDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_datasets.TandemDataset" title="masskit_ai.spectrum.spectrum_datasets.TandemDataset"><code class="xref py py-class docutils literal notranslate"><span class="pre">TandemDataset</span></code></a></p>
<p>dataset that retrieves each row by query, rather than from an in memory pandas dataframe.  The
index, however, is from an in memory pandas dataframe</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_datasets.TandemQueryDataset.get_data_row">
<span class="sig-name descname"><span class="pre">get_data_row</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">index</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_datasets.TandemQueryDataset.get_data_row" title="Permalink to this definition">¶</a></dt>
<dd><p>given the index, return corresponding data for the index</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-masskit_ai.spectrum.spectrum_embed">
<span id="masskit-ai-spectrum-spectrum-embed-module"></span><h2>masskit_ai.spectrum.spectrum_embed module<a class="headerlink" href="#module-masskit_ai.spectrum.spectrum_embed" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_embed.Embed1D">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_embed.</span></span><span class="sig-name descname"><span class="pre">Embed1D</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">config</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_embed.Embed1D" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="masskit_ai.html#masskit_ai.embed.Embed" title="masskit_ai.embed.Embed"><code class="xref py py-class docutils literal notranslate"><span class="pre">Embed</span></code></a></p>
<p>generic 1d embedding</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_embed.Embed1D.charge_channels">
<span class="sig-name descname"><span class="pre">charge_channels</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_embed.Embed1D.charge_channels" title="Permalink to this definition">¶</a></dt>
<dd><p>the number of charge channels.
no charge, which should be rare, is encoded as an empty vector</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the number of charge channels</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_embed.Embed1D.charge_embed">
<span class="sig-name descname"><span class="pre">charge_embed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">row</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_embed.Embed1D.charge_embed" title="Permalink to this definition">¶</a></dt>
<dd><p>embed the charge as a one hot tensor</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>row</strong> – data record</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>one hot tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_embed.Embed1D.charge_singleton_channels">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">charge_singleton_channels</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_embed.Embed1D.charge_singleton_channels" title="Permalink to this definition">¶</a></dt>
<dd><p>the number of charge_float channels</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the number of charge channels</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_embed.Embed1D.charge_singleton_embed">
<span class="sig-name descname"><span class="pre">charge_singleton_embed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">row</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_embed.Embed1D.charge_singleton_embed" title="Permalink to this definition">¶</a></dt>
<dd><p>embed the charge as a float tensor ranging from 0 to 1</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>row</strong> – data record</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>float tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_embed.Embed1D.ev_channels">
<span class="sig-name descname"><span class="pre">ev_channels</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_embed.Embed1D.ev_channels" title="Permalink to this definition">¶</a></dt>
<dd><p>the number of ev channels</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the number of ev channels</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_embed.Embed1D.ev_embed">
<span class="sig-name descname"><span class="pre">ev_embed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">row</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_embed.Embed1D.ev_embed" title="Permalink to this definition">¶</a></dt>
<dd><p>embed the ev as a one hot tensor</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>row</strong> – data record</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>one hot tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_embed.Embed1D.ev_singleton_channels">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">ev_singleton_channels</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_embed.Embed1D.ev_singleton_channels" title="Permalink to this definition">¶</a></dt>
<dd><p>the number of ev channels</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the number of ev_float channels</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_embed.Embed1D.ev_singleton_embed">
<span class="sig-name descname"><span class="pre">ev_singleton_embed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">row</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_embed.Embed1D.ev_singleton_embed" title="Permalink to this definition">¶</a></dt>
<dd><p>embed the ev as a single float value from 0 to 1</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>row</strong> – data record</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>FloatTensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_embed.Embed1D.nce_channels">
<span class="sig-name descname"><span class="pre">nce_channels</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_embed.Embed1D.nce_channels" title="Permalink to this definition">¶</a></dt>
<dd><p>the number of nce channels</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the number of nce channels</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_embed.Embed1D.nce_embed">
<span class="sig-name descname"><span class="pre">nce_embed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">row</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_embed.Embed1D.nce_embed" title="Permalink to this definition">¶</a></dt>
<dd><p>embed the nce as a one hot tensor</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>row</strong> – data record</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>one hot tensor</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_embed.Embed1D.nce_singleton_channels">
<em class="property"><span class="pre">static</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">nce_singleton_channels</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_embed.Embed1D.nce_singleton_channels" title="Permalink to this definition">¶</a></dt>
<dd><p>the number of nce channels</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>the number of nce_float channels</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_embed.Embed1D.nce_singleton_embed">
<span class="sig-name descname"><span class="pre">nce_singleton_embed</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">row</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_embed.Embed1D.nce_singleton_embed" title="Permalink to this definition">¶</a></dt>
<dd><p>embed the nce as a single float value from 0 to 1</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>row</strong> – data record</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>FloatTensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-masskit_ai.spectrum.spectrum_lightning">
<span id="masskit-ai-spectrum-spectrum-lightning-module"></span><h2>masskit_ai.spectrum.spectrum_lightning module<a class="headerlink" href="#module-masskit_ai.spectrum.spectrum_lightning" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_lightning.</span></span><span class="sig-name descname"><span class="pre">BaseSpectrumLightningModule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">LightningModule</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">ABC</span></code></p>
<p>base class for pytorch lightning module used to run the training</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.calc_loss">
<span class="sig-name descname"><span class="pre">calc_loss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.calc_loss" title="Permalink to this definition">¶</a></dt>
<dd><p>overrideable loss function</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output from the model</p></li>
<li><p><strong>batch</strong> – batch data, including input and true spectra</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.configure_optimizers">
<span class="sig-name descname"><span class="pre">configure_optimizers</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.configure_optimizers" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.forward" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.test_epoch_end">
<span class="sig-name descname"><span class="pre">test_epoch_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outputs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.test_epoch_end" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.test_step">
<span class="sig-name descname"><span class="pre">test_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_idx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.test_step" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.training_epoch_end">
<span class="sig-name descname"><span class="pre">training_epoch_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outputs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.training_epoch_end" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.training_step_end">
<span class="sig-name descname"><span class="pre">training_step_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outputs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.training_step_end" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.validation_epoch_end">
<span class="sig-name descname"><span class="pre">validation_epoch_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outputs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.validation_epoch_end" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.validation_step">
<span class="sig-name descname"><span class="pre">validation_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataloader_idx</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.validation_step" title="Permalink to this definition">¶</a></dt>
<dd><p>validation step</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>batch</strong> – batch data tensor</p></li>
<li><p><strong>batch_idx</strong> – the index of the batch</p></li>
<li><p><strong>dataloader_idx</strong> – which dataloader is being used (None if just one)</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.validation_test_epoch_end">
<span class="sig-name descname"><span class="pre">validation_test_epoch_end</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outputs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loop</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule.validation_test_epoch_end" title="Permalink to this definition">¶</a></dt>
<dd><p>shared code between validation and test epoch ends.  logs and prints losses, resets metrics</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>outputs</strong> – output list from model</p></li>
<li><p><strong>loop</strong> – ‘val’ or ‘test’</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.SpectrumDataModule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_lightning.</span></span><span class="sig-name descname"><span class="pre">SpectrumDataModule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.SpectrumDataModule" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="masskit_ai.html#masskit_ai.lightning.BaseDataModule" title="masskit_ai.lightning.BaseDataModule"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseDataModule</span></code></a></p>
<p>data loader for tandem spectra</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.SpectrumDataModule.create_loader">
<span class="sig-name descname"><span class="pre">create_loader</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">set_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.SpectrumDataModule.create_loader" title="Permalink to this definition">¶</a></dt>
<dd><p>helper function to load data</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>set_to_load</strong> – name of the set to load</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loader or list of loaders</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.SpectrumDataModule.get_dataset_path">
<span class="sig-name descname"><span class="pre">get_dataset_path</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spectral_library</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.SpectrumDataModule.get_dataset_path" title="Permalink to this definition">¶</a></dt>
<dd><p>for a given spectral_library, return the path (downloading file if necessary)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>spectral_library</strong> – name of the spectral library</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>path</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.SpectrumDataModule.get_subsets">
<span class="sig-name descname"><span class="pre">get_subsets</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">set_to_load</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.SpectrumDataModule.get_subsets" title="Permalink to this definition">¶</a></dt>
<dd><p>create datasets</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>set_to_load</strong> – train, valid or test dataset</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>a list of datasets</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.SpectrumLightningModule">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_lightning.</span></span><span class="sig-name descname"><span class="pre">SpectrumLightningModule</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.SpectrumLightningModule" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule" title="masskit_ai.spectrum.spectrum_lightning.BaseSpectrumLightningModule"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSpectrumLightningModule</span></code></a></p>
<p>pytorch lightning module used to run the training</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.SpectrumLightningModule.training_step">
<span class="sig-name descname"><span class="pre">training_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_idx</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.SpectrumLightningModule.training_step" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.SpectrumLightningModule.validation_test_step">
<span class="sig-name descname"><span class="pre">validation_test_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_idx</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loop</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.SpectrumLightningModule.validation_test_step" title="Permalink to this definition">¶</a></dt>
<dd><p>step shared with test and validation loops</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>batch</strong> – batch</p></li>
<li><p><strong>batch_idx</strong> – index into data for batch</p></li>
<li><p><strong>loop</strong> – the name of the loop</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_lightning.log_worker_start_spectrum">
<span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_lightning.</span></span><span class="sig-name descname"><span class="pre">log_worker_start_spectrum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">worker_id</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_lightning.log_worker_start_spectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>function for initializing the Dataset
Notes: since we are handling the sharding ourselves, it’s necessary to disable adding of Distributed Sampler
in Trainer by using replace_sampler_ddp=False</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>worker_id</strong> – worker rank</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-masskit_ai.spectrum.spectrum_losses">
<span id="masskit-ai-spectrum-spectrum-losses-module"></span><h2>masskit_ai.spectrum.spectrum_losses module<a class="headerlink" href="#module-masskit_ai.spectrum.spectrum_losses" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.MSEKLLoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses.</span></span><span class="sig-name descname"><span class="pre">MSEKLLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.MSEKLLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="masskit_ai.html#masskit_ai.base_objects.BaseLoss" title="masskit_ai.base_objects.BaseLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseLoss</span></code></a></p>
<p>mean square error plus kl divergence</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.MSEKLLoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.MSEKLLoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.MSELoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses.</span></span><span class="sig-name descname"><span class="pre">MSELoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.MSELoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="masskit_ai.html#masskit_ai.base_objects.BaseLoss" title="masskit_ai.base_objects.BaseLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseLoss</span></code></a></p>
<p>mean square error</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.MSELoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.MSELoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.SpectrumCosineKLLoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses.</span></span><span class="sig-name descname"><span class="pre">SpectrumCosineKLLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.SpectrumCosineKLLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss" title="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSpectrumLoss</span></code></a></p>
<p>cosine similarity of intensity channel and KL divergence</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.SpectrumCosineKLLoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.SpectrumCosineKLLoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model, type ModelOutput</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader, type ModelInput</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.SpectrumCosineLoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses.</span></span><span class="sig-name descname"><span class="pre">SpectrumCosineLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.SpectrumCosineLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss" title="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSpectrumLoss</span></code></a></p>
<p>cosine similarity of intensity channel</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.SpectrumCosineLoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.SpectrumCosineLoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model, type ModelOutput</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader, type ModelInput</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.SpectrumLogCosineKLLoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses.</span></span><span class="sig-name descname"><span class="pre">SpectrumLogCosineKLLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.SpectrumLogCosineKLLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss" title="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSpectrumLoss</span></code></a></p>
<p>log of cosine similarity of intensity channel and KL divergence</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.SpectrumLogCosineKLLoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.SpectrumLogCosineKLLoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model, type ModelOutput</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader, type ModelInput</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.SpectrumMSEKLLoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses.</span></span><span class="sig-name descname"><span class="pre">SpectrumMSEKLLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.SpectrumMSEKLLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss" title="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSpectrumLoss</span></code></a></p>
<p>mean square error of intensity channel plus KL divergence</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.SpectrumMSEKLLoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.SpectrumMSEKLLoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model, type ModelOutput</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader, type ModelInput</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.SpectrumMSELoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses.</span></span><span class="sig-name descname"><span class="pre">SpectrumMSELoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.SpectrumMSELoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss" title="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSpectrumLoss</span></code></a></p>
<p>mean square error of intensity channel</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.SpectrumMSELoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.SpectrumMSELoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model, type ModelOutput</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader, type ModelInput</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.SpectrumNormalNLL">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses.</span></span><span class="sig-name descname"><span class="pre">SpectrumNormalNLL</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.SpectrumNormalNLL" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss" title="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSpectrumLoss</span></code></a></p>
<p>negative log likelihood loss for a normal distribution for a spectral model that emits predictions
and variance of that prediction
omits constants in log likelihood</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses.SpectrumNormalNLL.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses.SpectrumNormalNLL.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model, type ModelOutput</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader, type ModelInput</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-masskit_ai.spectrum.spectrum_losses_bayes">
<span id="masskit-ai-spectrum-spectrum-losses-bayes-module"></span><h2>masskit_ai.spectrum.spectrum_losses_bayes module<a class="headerlink" href="#module-masskit_ai.spectrum.spectrum_losses_bayes" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.MSEKLLoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses_bayes.</span></span><span class="sig-name descname"><span class="pre">MSEKLLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.MSEKLLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="masskit_ai.html#masskit_ai.base_objects.BaseLoss" title="masskit_ai.base_objects.BaseLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseLoss</span></code></a></p>
<p>mean square error plus kl divergence</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.MSEKLLoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.MSEKLLoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.MSELoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses_bayes.</span></span><span class="sig-name descname"><span class="pre">MSELoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.MSELoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="masskit_ai.html#masskit_ai.base_objects.BaseLoss" title="masskit_ai.base_objects.BaseLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseLoss</span></code></a></p>
<p>mean square error</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.MSELoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.MSELoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.SpectrumCosineKLLoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses_bayes.</span></span><span class="sig-name descname"><span class="pre">SpectrumCosineKLLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.SpectrumCosineKLLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss" title="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSpectrumLoss</span></code></a></p>
<p>cosine similarity of intensity channel and KL divergence</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.SpectrumCosineKLLoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.SpectrumCosineKLLoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model, type ModelOutput</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader, type ModelInput</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.SpectrumCosineLoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses_bayes.</span></span><span class="sig-name descname"><span class="pre">SpectrumCosineLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.SpectrumCosineLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss" title="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSpectrumLoss</span></code></a></p>
<p>cosine similarity of intensity channel</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.SpectrumCosineLoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.SpectrumCosineLoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model, type ModelOutput</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader, type ModelInput</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.SpectrumLogCosineKLLoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses_bayes.</span></span><span class="sig-name descname"><span class="pre">SpectrumLogCosineKLLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.SpectrumLogCosineKLLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss" title="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSpectrumLoss</span></code></a></p>
<p>log of cosine similarity of intensity channel and KL divergence</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.SpectrumLogCosineKLLoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.SpectrumLogCosineKLLoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model, type ModelOutput</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader, type ModelInput</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.SpectrumMSEKLLoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses_bayes.</span></span><span class="sig-name descname"><span class="pre">SpectrumMSEKLLoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.SpectrumMSEKLLoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss" title="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSpectrumLoss</span></code></a></p>
<p>mean square error of intensity channel plus KL divergence</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.SpectrumMSEKLLoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.SpectrumMSEKLLoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model, type ModelOutput</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader, type ModelInput</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.SpectrumMSELoss">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses_bayes.</span></span><span class="sig-name descname"><span class="pre">SpectrumMSELoss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.SpectrumMSELoss" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss" title="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSpectrumLoss</span></code></a></p>
<p>mean square error of intensity channel</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.SpectrumMSELoss.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.SpectrumMSELoss.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model, type ModelOutput</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader, type ModelInput</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.SpectrumNormalNLL">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_losses_bayes.</span></span><span class="sig-name descname"><span class="pre">SpectrumNormalNLL</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.SpectrumNormalNLL" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss" title="masskit_ai.spectrum.spectrum_base_objects.BaseSpectrumLoss"><code class="xref py py-class docutils literal notranslate"><span class="pre">BaseSpectrumLoss</span></code></a></p>
<p>negative log likelihood loss for a normal distribution for a spectral model that emits predictions
and variance of that prediction
omits constants in log likelihood</p>
<dl class="py method">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_losses_bayes.SpectrumNormalNLL.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">params</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><span class="pre">torch.Tensor</span></span></span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_losses_bayes.SpectrumNormalNLL.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>calculate the loss</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> – output dictionary from the model, type ModelOutput</p></li>
<li><p><strong>batch</strong> – batch data from the dataloader, type ModelInput</p></li>
<li><p><strong>params</strong> – optional dictionary of parameters, such as epoch type</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>loss tensor</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-masskit_ai.spectrum.spectrum_prediction">
<span id="masskit-ai-spectrum-spectrum-prediction-module"></span><h2>masskit_ai.spectrum.spectrum_prediction module<a class="headerlink" href="#module-masskit_ai.spectrum.spectrum_prediction" title="Permalink to this heading">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_prediction.PredictedSpectrum">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_prediction.</span></span><span class="sig-name descname"><span class="pre">PredictedSpectrum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Any</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_prediction.PredictedSpectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">AccumulatorSpectrum</span></code></p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_prediction.apply_dropout">
<span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_prediction.</span></span><span class="sig-name descname"><span class="pre">apply_dropout</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_prediction.apply_dropout" title="Permalink to this definition">¶</a></dt>
<dd><p>for use by torch apply to turn on dropout in a model in eval mode.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>model</strong> – the model</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_prediction.create_mz_tolerance">
<span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_prediction.</span></span><span class="sig-name descname"><span class="pre">create_mz_tolerance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_prediction.create_mz_tolerance" title="Permalink to this definition">¶</a></dt>
<dd><p>generate mz array and mass tolerance for model</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>model</strong> – the model to use</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>mz, tolerance</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_prediction.create_prediction_dataset">
<span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_prediction.</span></span><span class="sig-name descname"><span class="pre">create_prediction_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">set_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'test'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataloader</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'TandemArrowDataset'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy_annotations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predicted_spectrum_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'predicted_spectrum'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_singleton</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_prediction.create_prediction_dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Create pandas dataframe(s) that contains experimental spectra and can be used for predicting spectra
each dataframe corresponds to a single validation/test/train set.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dataloader</strong> – name of the dataloader class, e.g. TandemArrowDataset</p></li>
<li><p><strong>set_to_load</strong> – name of the set to use, e.g. “valid”, “test”, “train”</p></li>
<li><p><strong>model</strong> – the model to use to predict spectrum</p></li>
<li><p><strong>num</strong> – the number of spectra to predict (0 = all)</p></li>
<li><p><strong>copy_annotations</strong> – copy annotations and precursor from experimental spectra to predicted spectra</p></li>
<li><p><strong>predicted_spectrum_column</strong> – name of the column containing the predicted spectrum</p></li>
<li><p><strong>return_singleton</strong> – if there is only one dataframe, don’t return lists</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of dataframes for doing predictions, list of dataset objects</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_prediction.create_prediction_dataset_from_hitlist">
<span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_prediction.</span></span><span class="sig-name descname"><span class="pre">create_prediction_dataset_from_hitlist</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hitlist</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">experimental_tablemap</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">set_to_load</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'test'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">copy_annotations</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predicted_spectrum_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'predicted_spectrum'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_singleton</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_prediction.create_prediction_dataset_from_hitlist" title="Permalink to this definition">¶</a></dt>
<dd><p>Create pandas dataframe(s) that contains experimental spectra and can be used for predicting spectra
each dataframe corresponds to a single validation/test/train set.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> – the model to use to predict spectrum</p></li>
<li><p><strong>set_to_load</strong> – name of the set to use, e.g. “valid”, “test”, “train”</p></li>
<li><p><strong>hitlist</strong> – the Hitlist object</p></li>
<li><p><strong>experimental_spectra</strong> – TableMap containing the experimental spectra, used to get eV</p></li>
<li><p><strong>num</strong> – the number of spectra to predict (0 = all)</p></li>
<li><p><strong>copy_annotations</strong> – copy annotations and precursor from experimental spectra to predicted spectra</p></li>
<li><p><strong>predicted_spectrum_column</strong> – name of the column containing the predicted spectrum</p></li>
<li><p><strong>return_singleton</strong> – if there is only one dataframe, don’t return lists</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>list of dataframes for doing predictions, list of dataset objects</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_prediction.finalize_prediction_dataset">
<span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_prediction.</span></span><span class="sig-name descname"><span class="pre">finalize_prediction_dataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predicted_spectrum_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'predicted_spectrum'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_intensity</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mz_window</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">7</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_mz</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_mz</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_prediction.finalize_prediction_dataset" title="Permalink to this definition">¶</a></dt>
<dd><p>do final processing on the predicted spectra</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> – dataframe containing spectra</p></li>
<li><p><strong>predicted_spectrum_column</strong> – name of the predicted spectrum column</p></li>
<li><p><strong>min_intensity</strong> – the minimum intensity of the predicted spectra</p></li>
<li><p><strong>mz_window</strong> – half size of mz_window for filtering.  0 = no filtering</p></li>
<li><p><strong>max_mz</strong> – maximum mz value for calculating cosine score.  0 means don’t filter</p></li>
<li><p><strong>min_mz</strong> – the minimum mz value for calculation the cosine score</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_prediction.prep_model_for_prediction">
<span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_prediction.</span></span><span class="sig-name descname"><span class="pre">prep_model_for_prediction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dropout</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_prediction.prep_model_for_prediction" title="Permalink to this definition">¶</a></dt>
<dd><p>prepare the model for inference</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> – the model</p></li>
<li><p><strong>dropout</strong> – should dropout be turned on?</p></li>
<li><p><strong>model</strong> – place model on cpu?</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_prediction.single_spectrum_prediction">
<span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_prediction.</span></span><span class="sig-name descname"><span class="pre">single_spectrum_prediction</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dataset_element</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_intensity_in</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">999</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cpu</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">take_sqrt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">l2norm</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_prediction.single_spectrum_prediction" title="Permalink to this definition">¶</a></dt>
<dd><p>predict a single spectrum</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> – the prediction model</p></li>
<li><p><strong>dataset_element</strong> – dataset element</p></li>
<li><p><strong>max_intensity_in</strong> – the intensity of the most intense peak (0=don’t normalize)</p></li>
<li><p><strong>cpu</strong> – do computations on cpu.  Note, model should be prepared on cpu</p></li>
<li><p><strong>take_sqrt</strong> – square the output of the model</p></li>
<li><p><strong>l2norm</strong> – l2 normalize the predicted specta</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>the predicted spectrum</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_prediction.upres_peptide_spectra">
<span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_prediction.</span></span><span class="sig-name descname"><span class="pre">upres_peptide_spectra</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">df</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predicted_spectrum_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">theoretical_spectrum_column</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ion_types</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_mz</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_mz</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_prediction.upres_peptide_spectra" title="Permalink to this definition">¶</a></dt>
<dd><p>take a dataframe with predicted spectra, generate matching theoretical spectra, and upres
matching peaks</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>df</strong> – the dataframe</p></li>
<li><p><strong>predicted_spectrum_column</strong> – name of the column containing predicted spectra, defaults to None</p></li>
<li><p><strong>theoretical_spectrum_column</strong> – name of the column to contain theoretical spectra, defaults to None</p></li>
<li><p><strong>ion_types</strong> – ion types to use when generating theoretical spectra, defaults to None</p></li>
<li><p><strong>max_mz</strong> – maximum mz value for calculating cosine score.  0 means don’t filter</p></li>
<li><p><strong>min_mz</strong> – the minimum mz value for calculation the cosine score</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="masskit_ai.spectrum.spectrum_prediction.upres_peptide_spectrum">
<span class="sig-prename descclassname"><span class="pre">masskit_ai.spectrum.spectrum_prediction.</span></span><span class="sig-name descname"><span class="pre">upres_peptide_spectrum</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">predicted_spectrum</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">theoretical_spectrum</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#masskit_ai.spectrum.spectrum_prediction.upres_peptide_spectrum" title="Permalink to this definition">¶</a></dt>
<dd><p>match a theoretical peptide spectrum to a predicted spectrum and copy over the theoretical mz values to
the predicted spectrum. If there are more than one matches to a predicted spectrum, don’t match</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>predicted_spectrum</strong> – the predicted spectrum</p></li>
<li><p><strong>theoretical_spectrum</strong> – the theoretical spectrum</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-masskit_ai.spectrum">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-masskit_ai.spectrum" title="Permalink to this heading">¶</a></h2>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">masskit_ai.spectrum package</a><ul>
<li><a class="reference internal" href="#subpackages">Subpackages</a></li>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-masskit_ai.spectrum.spectrum_base_objects">masskit_ai.spectrum.spectrum_base_objects module</a></li>
<li><a class="reference internal" href="#module-masskit_ai.spectrum.spectrum_datasets">masskit_ai.spectrum.spectrum_datasets module</a></li>
<li><a class="reference internal" href="#module-masskit_ai.spectrum.spectrum_embed">masskit_ai.spectrum.spectrum_embed module</a></li>
<li><a class="reference internal" href="#module-masskit_ai.spectrum.spectrum_lightning">masskit_ai.spectrum.spectrum_lightning module</a></li>
<li><a class="reference internal" href="#module-masskit_ai.spectrum.spectrum_losses">masskit_ai.spectrum.spectrum_losses module</a></li>
<li><a class="reference internal" href="#module-masskit_ai.spectrum.spectrum_losses_bayes">masskit_ai.spectrum.spectrum_losses_bayes module</a></li>
<li><a class="reference internal" href="#module-masskit_ai.spectrum.spectrum_prediction">masskit_ai.spectrum.spectrum_prediction module</a></li>
<li><a class="reference internal" href="#module-masskit_ai.spectrum">Module contents</a></li>
</ul>
</li>
</ul>

  </div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/masskit_ai.spectrum.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">masskit_ai 0.1 documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">masskit_ai.spectrum package</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>